<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ ªä¾¡æƒ…å ±ã¾ã¨ã‚</title>

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-title" content="æ ªä¾¡æƒ…å ±">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- å…¨ä½“è¨­å®š --- */
        body {
            font-family: 'Roboto', 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            padding-top: 100px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹ã‚¿ãƒ–ã®é«˜ã• */
            -webkit-text-size-adjust: 100%;
        }

        /* --- å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .fixed-header-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* 1. ã‚¿ã‚¤ãƒˆãƒ«è¡Œ */
        .header-title-row {
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            border-bottom: 1px solid #eee;
        }
        .app-title {
            color: #333;
            font-size: 16px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
        }
        .title-icon { margin-right: 6px; font-size: 18px; }

        /* 2. ã‚¿ãƒ–è¡Œï¼ˆ4ã¤ä¸¦ã³ãƒ»é»’èƒŒæ™¯Ã—é»„è‰²æ–‡å­—ï¼‰ */
        .tab-container {
            display: flex;
            justify-content: space-around;
            background-color: #111; /* é»’ */
            padding: 0;
            margin: 0;
        }

        .tab-button {
            flex: 1;
            padding: 12px 0;
            background: none;
            border: none;
            color: #888; /* æœªé¸æŠã¯ã‚°ãƒ¬ãƒ¼ */
            font-size: 12px; /* 4ã¤ä¸¦ã¶ã®ã§å°‘ã—å°ã•ã‚ */
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            white-space: nowrap;
        }

        /* é¸æŠä¸­ã®ã‚¿ãƒ– */
        .tab-button.active {
            color: #FFD700; /* é»„è‰² */
            background-color: #222;
        }
        
        /* é¸æŠä¸­ã‚¿ãƒ–ã®ä¸‹ç·š */
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10%;
            width: 80%;
            height: 3px;
            background-color: #FFD700;
        }

        /* --- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢åˆ‡ã‚Šæ›¿ãˆ --- */
        .content-area {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            width: 100%;
            min-height: 300px;
        }
        .content-area.active {
            display: block; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ–¹ã ã‘è¡¨ç¤º */
        }

        /* --- ãƒ†ãƒ¼ãƒ–ãƒ«å…±é€šè¨­å®š --- */
        .table-container {
            width: 100%;
            background-color: white;
            overflow-x: hidden;
        }

        table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
            font-size: 11px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¿ƒã„ãƒ”ãƒ³ã‚¯ï¼‰ */
        th {
            background-color: #e91e63;
            color: white;
            padding: 8px 0;
            font-weight: bold;
            text-align: center;
            font-size: 11px;
            white-space: nowrap;
            position: sticky;
            top: 0; 
        }

        td {
            padding: 10px 2px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            line-height: 1.3;
        }

        /* ã‚·ãƒã‚¦ãƒ */
        tr:nth-child(even) { background-color: #f9f9f9; }

        /* --- Sé«˜ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        /* [æ—¥ä»˜, çŠ¶æ…‹, ã‚³ãƒ¼ãƒ‰, éŠ˜æŸ„, ç¾åœ¨å€¤, å‰æ—¥æ¯”] */
        #table-sdaka th:nth-child(1), #table-sdaka td:nth-child(1) { width: 13%; text-align: center; font-size: 10px; color:#666; } 
        #table-sdaka th:nth-child(2), #table-sdaka td:nth-child(2) { width: 10%; text-align: center; font-weight: bold; } 
        #table-sdaka th:nth-child(3), #table-sdaka td:nth-child(3) { width: 14%; text-align: center; } 
        #table-sdaka th:nth-child(4), #table-sdaka td:nth-child(4) { width: 31%; text-align: left; font-weight: bold; white-space: normal; word-break: break-all;} 
        #table-sdaka th:nth-child(5), #table-sdaka td:nth-child(5) { width: 16%; text-align: right; letter-spacing:-0.5px;} 
        #table-sdaka th:nth-child(6), #table-sdaka td:nth-child(6) { width: 16%; text-align: right; letter-spacing:-0.5px;}

        /* æ—¥ä»˜åŒºåˆ‡ã‚Šç·š */
        tr.date-separator { border-top: 3px solid #ddd; }

        /* --- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        /* [CD, éŠ˜æŸ„, å›æ•°, %, å¹…, æ ªä¾¡] (indexåˆ—ã¯éè¡¨ç¤º) */
        #table-ranking th:nth-child(1), #table-ranking td:nth-child(1) { width: 0; display: none; } /* indexéš ã— */
        #table-ranking th:nth-child(2), #table-ranking td:nth-child(2) { width: 13%; text-align: center; } /* CD */
        #table-ranking th:nth-child(3), #table-ranking td:nth-child(3) { width: 29%; text-align: left; font-weight: bold; white-space: normal; word-break: break-all;} /* éŠ˜æŸ„ */
        #table-ranking th:nth-child(4), #table-ranking td:nth-child(4) { width: 15%; text-align: right; letter-spacing:-0.5px;} /* å›æ•° */
        #table-ranking th:nth-child(5), #table-ranking td:nth-child(5) { width: 13%; text-align: right; letter-spacing:-0.5px;} /* % */
        #table-ranking th:nth-child(6), #table-ranking td:nth-child(6) { width: 14%; text-align: right; letter-spacing:-0.5px;} /* å¹… */
        #table-ranking th:nth-child(7), #table-ranking td:nth-child(7) { width: 16%; text-align: right; font-weight:500;} /* æ ªä¾¡ */


        /* --- ãƒœã‚¿ãƒ³ãƒ»è£…é£¾ --- */
        .yahoo-btn {
            display: inline-block;
            background-color: #cc0000;
            color: white;
            font-size: 9px;
            padding: 1px 3px;
            border-radius: 3px;
            text-decoration: none;
            margin-top: 2px;
            font-family: sans-serif;
        }
        .x-btn {
            display: inline-block;
            background-color: #000;
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            border-radius: 3px;
            text-decoration: none;
            margin-top: 3px;
        }
        .kabutan-icon {
            color: #cc0000;
            font-size: 13px;
            margin-right: 2px;
            text-decoration: none;
        }

        /* æ–‡å­—è‰² */
        .text-red { color: #cc0000; font-weight: bold;}
        .text-blue { color: #0000cc; font-weight: bold;}
        .text-black { color: #000; }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ */
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 14px;
        }
        .info-bar {
            text-align: right;
            font-size: 10px;
            color: #666;
            padding: 5px 10px;
            background: white;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>

    <div class="fixed-header-container">
        <div class="header-title-row">
            <h1 class="app-title" id="pageTitle">
                <span class="title-icon">ğŸ“ˆ</span>ã‚¹ãƒˆãƒƒãƒ—é«˜ãƒ»ã‚¹ãƒˆãƒƒãƒ—å®‰ å±¥æ­´
            </h1>
        </div>
        
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('sdaka')">Sé«˜å±¥æ­´</button>
            <button class="tab-button" onclick="switchTab('all')">å…¨å¸‚å ´</button>
            <button class="tab-button" onclick="switchTab('std')">ã‚¹ã‚¿ãƒ³ãƒ€</button>
            <button class="tab-button" onclick="switchTab('grw')">ã‚°ãƒ­ãƒ¼ã‚¹</button>
        </div>
    </div>

    <div id="area-sdaka" class="content-area active">
        <div id="loading-sdaka" class="loading">Sé«˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="table-container">
            <table id="table-sdaka">
                </table>
        </div>
    </div>

    <div id="area-ranking" class="content-area">
        <div id="loading-ranking" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="info-bar" id="update-time-ranking"></div>
        <div class="table-container">
            <table id="table-ranking">
                <thead><tr id="header-ranking"></tr></thead>
                <tbody id="body-ranking"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ===============================================
        // â˜…â˜…â˜… è¨­å®šã‚¨ãƒªã‚¢ (URL) â˜…â˜…â˜…
        // ===============================================
        
        // 1. Sé«˜å±¥æ­´ (GAS JSON)
        const sHighGasUrl = "https://script.google.com/macros/s/AKfycbyc8KXuA7A_-4_LpTY6RO0Ip9r3ED_g9NtMDgtbzLgpH-hwtouK8db3Zp_8sls-jVVk/exec";

        // 2. æ´»æ³éŠ˜æŸ„ (CSV)
        const rankingUrls = {
            'all': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=0&single=true&output=csv',
            'std': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=1953765914&single=true&output=csv',
            'grw': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=1943516156&single=true&output=csv'
        };

        // ===============================================

        // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚
        window.onload = function() {
            loadSHighData(); // æœ€åˆã¯Sé«˜ã‚’è¡¨ç¤º
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchTab(mode) {
            // ã‚¿ãƒ–ã®è¦‹ãŸç›®
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const areaSdaka = document.getElementById('area-sdaka');
            const areaRanking = document.getElementById('area-ranking');
            const pageTitle = document.querySelector('#pageTitle');

            if (mode === 'sdaka') {
                // Sé«˜ã‚¿ãƒ–
                areaSdaka.classList.add('active');
                areaRanking.classList.remove('active');
                pageTitle.innerHTML = '<span class="title-icon">ğŸ“ˆ</span>ã‚¹ãƒˆãƒƒãƒ—é«˜ãƒ»ã‚¹ãƒˆãƒƒãƒ—å®‰ å±¥æ­´';
                // ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°èª­ã¿è¾¼ã‚€ï¼ˆæ—¢ã«ã‚ã‚Œã°ãã®ã¾ã¾ï¼‰
                if(document.getElementById('table-sdaka').rows.length === 0) loadSHighData
