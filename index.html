<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>株価情報まとめ</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 全体設定 --- */
        body {
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            padding-top: 110px; /* ヘッダー固定分の余白 */
        }

        /* --- 固定ヘッダー（黒×黄色） --- */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #111;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .app-title {
            color: #FFD700; /* 黄色 */
            text-align: center;
            margin: 0;
            padding: 12px 0 5px 0;
            font-size: 16px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        /* --- タブデザイン --- */
        .tab-container {
            display: flex;
            justify-content: space-around;
            padding: 0;
            margin: 0;
        }

        .tab-button {
            flex: 1;
            padding: 12px 0;
            background: none;
            border: none;
            color: #888;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-button.active {
            color: #FFD700;
            border-bottom: 3px solid #FFD700;
            background-color: #222;
        }

        /* --- コンテンツエリア --- */
        .content-area {
            display: none; /* 初期状態は非表示 */
            width: 100%;
        }
        .content-area.active {
            display: block; /* アクティブなタブだけ表示 */
        }

        /* --- テーブルデザイン --- */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background-color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            white-space: nowrap;
        }

        th {
            background-color: #e91e63; /* 共通の濃いピンクヘッダー */
            color: white;
            padding: 10px 8px;
            position: sticky;
            top: 0;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ddd;
            vertical-align: middle;
        }

        /* シマウマ模様 */
        tr:nth-child(even) { background-color: #fce4ec; }
        tr:nth-child(odd) { background-color: #ffffff; }

        /* 文字色・配置 */
        .text-center { text-align: center; }
        .text-left   { text-align: left; }
        .text-right  { text-align: right; }
        .text-red    { color: #cc0000; font-weight: bold; }
        .text-blue   { color: #0000cc; font-weight: bold; }
        .text-black  { color: #000000; }

        /* 更新日時など */
        .info-bar {
            text-align: right;
            font-size: 11px;
            color: #666;
            padding: 5px 10px;
        }

        /* ローディング */
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="fixed-header">
        <h1 class="app-title" id="pageTitle">S高・S安 履歴</h1>
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('sdaka')">S高履歴</button>
            <button class="tab-button" onclick="switchTab('all')">全市場</button>
            <button class="tab-button" onclick="switchTab('std')">スタンダ</button>
            <button class="tab-button" onclick="switchTab('grw')">グロース</button>
        </div>
    </div>

    <div id="area-sdaka" class="content-area active">
        <div id="loading-sdaka" class="loading">S高データを読み込み中...</div>
        <div class="table-container">
            <table id="table-sdaka">
                </table>
        </div>
    </div>

    <div id="area-ranking" class="content-area">
        <div id="loading-ranking" class="loading">ランキングを読み込み中...</div>
        <div class="info-bar" id="update-time-ranking"></div>
        <div class="table-container">
            <table id="table-ranking">
                <thead><tr id="header-ranking"></tr></thead>
                <tbody id="body-ranking"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ===============================================
        // ★★★ 設定エリア（ここだけ書き換えて！） ★★★
        // ===============================================
        
        // 1. S高履歴のGASウェブアプリURL（あなたのGASのURL）
        const sHighGasUrl = "https://script.google.com/macros/s/AKfycbzvdeV4ek9JwVp9uM8es2DwJApOnkPu6VOw0TztKubOxjWFFxzjT__8iQPKzsEBzBvd/exec";

        // 2. 活況銘柄のCSV URL（変更不要）
        const rankingUrls = {
            'all': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=0&single=true&output=csv',
            'std': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=1953765914&single=true&output=csv',
            'grw': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSFL74v22ZNoGTNvcwbw9WnYRw9Hdl53zsSOE8Wwy6Jl76aDFxro3RHR-KhULyzLU0f4byxOEmX7Ef/pub?gid=1943516156&single=true&output=csv'
        };

        // ===============================================

        // 初回読み込み
        window.onload = function() {
            loadSHighData(); // S高データを読みに行く
        };

        // タブ切り替え処理
        function switchTab(mode) {
            // タブの見た目変更
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // 表示エリア切り替え
            const areaSdaka = document.getElementById('area-sdaka');
            const areaRanking = document.getElementById('area-ranking');
            const pageTitle = document.getElementById('pageTitle');

            if (mode === 'sdaka') {
                areaSdaka.classList.add('active');
                areaRanking.classList.remove('active');
                pageTitle.innerText = "S高・S安 履歴";
            } else {
                areaSdaka.classList.remove('active');
                areaRanking.classList.add('active');
                pageTitle.innerText = "本日活況銘柄速報";
                // 活況データを読み込む
                loadRankingData(mode);
            }
            window.scrollTo(0, 0);
        }

        // --- A. S高データを読み込んで表示する関数 ---
        function loadSHighData() {
            const table = document.getElementById('table-sdaka');
            const loading = document.getElementById('loading-sdaka');
            
            fetch(sHighGasUrl)
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    renderSHighTable(data);
                })
                .catch(err => {
                    loading.innerHTML = "読み込み失敗<br>GASのURLを確認してください";
                    console.error(err);
                });
        }

        function renderSHighTable(data) {
            const table = document.getElementById('table-sdaka');
            let html = `<thead><tr>
                <th>日付</th><th>状態</th><th>コード</th><th>銘柄名</th><th>現在値</th><th>前日比</th>
            </tr></thead><tbody>`;

            // データ行のループ (新しい日付順にするため reverse するか、GAS順のままならそのまま)
            // GASで下に追加しているなら、reverse()すると最新が上に来ます
            const rows = data.slice(1).reverse(); 

            rows.forEach(row => {
                // row: [日付, 状態, コード, 銘柄, 現在値, 前日比]
                // 状態(S高/S安)の色分け
                let statusColor = "text-black";
                if(row[1].includes("S高")) statusColor = "text-red";
                if(row[1].includes("S安")) statusColor = "text-blue";

                // 前日比の色分け
                let changeColor = "text-black";
                if(String(row[5]).includes('+')) changeColor = "text-red";
                if(String(row[5]).includes('-')) changeColor = "text-blue";

                html += `<tr>
                    <td class="text-center">${row[0]}</td>
                    <td class="text-center ${statusColor}">${row[1]}</td>
                    <td class="text-center">${row[2]}</td>
                    <td class="text-left">${row[3]}</td>
                    <td class="text-right">${row[4]}</td>
                    <td class="text-right ${changeColor}">${row[5]}</td>
                </tr>`;
            });

            html += `</tbody>`;
            table.innerHTML = html;
        }


        // --- B. 活況銘柄データを読み込んで表示する関数 ---
        function loadRankingData(tabName) {
            const url = rankingUrls[tabName];
            const loading = document.getElementById('loading-ranking');
            const tableBody = document.getElementById('body-ranking');
            const tableHeader = document.getElementById('header-ranking');
            const updateTime = document.getElementById('update-time-ranking');

            loading.style.display = 'block';
            tableBody.innerHTML = '';
            tableHeader.innerHTML = '';
            updateTime.innerText = '';

            fetch(url).then(r => r.text()).then(t => {
                const rows = parseCSV(t);
                renderRankingTable(rows);
                loading.style.display = 'none';
            });
        }

        function renderRankingTable(data) {
            const th = document.getElementById('header-ranking');
            const tb = document.getElementById('body-ranking');
            if (data.length === 0) return;
            
            const h = data[0];
            if(data.length > 1) document.getElementById('update-time-ranking').innerText = "最終更新: " + data[1][0];
            
            let hHTML = '';
            for (let i = 1; i < h.length; i++) hHTML += `<th>${h[i]}</th>`;
            th.innerHTML = hHTML;

            let bHTML = '';
            for (let i = 1; i < data.length; i++) {
                const r = data[i]; if (r.length < h.length) continue;
                bHTML += `<tr>`;
                for (let j = 1; j < r.length; j++) {
                    let cls = "text-right text-black";
                    if (j === 1) cls = "text-center text-black";
                    if (j === 2) cls = "text-left text-black";
                    
                    if (r[j].includes('+')) cls = cls.replace('text-black', 'text-red');
                    else if (r[j].includes('-') && !r[j].includes('－')) cls = cls.replace('text-black', 'text-blue');
                    
                    bHTML += `<td class="${cls}">${r[j]}</td>`;
                }
                bHTML += `</tr>`;
            }
            tb.innerHTML = bHTML;
        }

        function parseCSV(text) {
            const rows = []; let row = []; let cell = ""; let inQuote = false;
            for (let i = 0; i < text.length; i++) {
                const c = text[i], n = text[i+1];
                if (c === '"') { if (inQuote && n === '"') { cell += '"'; i++; } else { inQuote = !inQuote; } }
                else if (c === ',' && !inQuote) { row.push(cell); cell = ""; }
                else if ((c === '\r' || c === '\n') && !inQuote) { if (cell||row.length) { row.push(cell); rows.push(row); } row=[]; cell=""; if(c==='\r'&&n==='\n')i++; }
                else { cell += c; }
            }
            if (cell || row.length) { row.push(cell); rows.push(row); }
            return rows;
        }
    </script>
</body>
</html>
